<!-- مسیر فایل: UI/Dialogs/DashboardCustomizeDialog.xaml -->
<!-- ابتدای کد -->
<Window x:Class="TradingJournal.UI.Dialogs.DashboardCustomizeDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:md="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="سفارشی‌سازی داشبورد"
        Height="700" Width="900"
        WindowStartupLocation="CenterScreen"
        FlowDirection="RightToLeft"
        Style="{StaticResource MaterialDesignWindow}">
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0" Margin="16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Available Widgets -->
            <GroupBox Grid.Column="0" Header="ویجت‌های موجود" Margin="0,0,8,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Button Grid.Row="0"
                            Content="ویجت جدید"
                            Click="OnCreateNewWidget"
                            Style="{StaticResource MaterialDesignRaisedButton}"
                            HorizontalAlignment="Right"
                            Margin="0,8"/>

                    <ListBox Grid.Row="1"
                             x:Name="AvailableListBox"
                             ItemsSource="{Binding AvailableWidgets}"
                             ScrollViewer.VerticalScrollBarVisibility="Auto">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <md:Card Padding="8" Margin="2">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <md:PackIcon Grid.Column="0"
                                                     Kind="{Binding Type, Converter={StaticResource WidgetTypeToIcon}}"
                                                     Width="24" Height="24"
                                                     VerticalAlignment="Center"
                                                     Margin="0,0,8,0"/>
                                        
                                        <StackPanel Grid.Column="1">
                                            <TextBlock Text="{Binding Title}"
                                                       FontWeight="Bold"/>
                                            <TextBlock Text="{Binding Type}"
                                                       FontSize="10"
                                                       Opacity="0.7"/>
                                        </StackPanel>
                                    </Grid>
                                </md:Card>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Grid>
            </GroupBox>

            <!-- Move Buttons -->
            <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="8">
                <Button Click="OnAddWidget"
                        Style="{StaticResource MaterialDesignFloatingActionMiniButton}"
                        ToolTip="افزودن به داشبورد"
                        Margin="0,4">
                    <md:PackIcon Kind="ChevronRight"/>
                </Button>
                
                <Button Click="OnRemoveWidget"
                        Style="{StaticResource MaterialDesignFloatingActionMiniButton}"
                        ToolTip="حذف از داشبورد"
                        Margin="0,4">
                    <md:PackIcon Kind="ChevronLeft"/>
                </Button>
            </StackPanel>

            <!-- Active Widgets -->
            <GroupBox Grid.Column="2" Header="ویجت‌های فعال" Margin="8,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <ListBox Grid.Row="0"
                             x:Name="ActiveListBox"
                             ItemsSource="{Binding ActiveWidgets}"
                             SelectionChanged="OnWidgetSelected"
                             ScrollViewer.VerticalScrollBarVisibility="Auto">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <md:Card Padding="8" Margin="2">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <TextBlock Grid.Column="0"
                                                   Text="{Binding Order}"
                                                   FontWeight="Bold"
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,8,0"/>
                                        
                                        <StackPanel Grid.Column="1">
                                            <TextBlock Text="{Binding Title}"
                                                       FontWeight="Bold"/>
                                            <TextBlock FontSize="10"
                                                       Opacity="0.7">
                                                <TextBlock.Text>
                                                    <MultiBinding StringFormat="{}{0} - {1}">
                                                        <Binding Path="Type"/>
                                                        <Binding Path="Size"/>
                                                    </MultiBinding>
                                                </TextBlock.Text>
                                            </TextBlock>
                                        </StackPanel>
                                        
                                        <StackPanel Grid.Column="2" Orientation="Horizontal">
                                            <Button Click="OnMoveUp"
                                                    Style="{StaticResource MaterialDesignIconButton}"
                                                    ToolTip="بالا"
                                                    Width="24" Height="24">
                                                <md:PackIcon Kind="ArrowUp" Width="16"/>
                                            </Button>
                                            <Button Click="OnMoveDown"
                                                    Style="{StaticResource MaterialDesignIconButton}"
                                                    ToolTip="پایین"
                                                    Width="24" Height="24">
                                                <md:PackIcon Kind="ArrowDown" Width="16"/>
                                            </Button>
                                        </StackPanel>
                                    </Grid>
                                </md:Card>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>

                    <Button Grid.Row="1"
                            Content="حذف ویجت"
                            Click="OnDeleteWidget"
                            Style="{StaticResource MaterialDesignFlatButton}"
                            Foreground="Red"
                            HorizontalAlignment="Right"
                            Margin="0,8,0,0"/>
                </Grid>
            </GroupBox>

            <!-- Widget Settings -->
            <GroupBox Grid.Column="3" Header="تنظیمات ویجت" Margin="8,0,0,0">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="8" IsEnabled="{Binding SelectedWidget, Converter={StaticResource NullToFalse}}">
                        <TextBox x:Name="WidgetNameTextBox"
                                 md:HintAssist.Hint="نام ویجت"
                                 Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                 Margin="0,8"/>
                        
                        <TextBox x:Name="WidgetTitleTextBox"
                                 md:HintAssist.Hint="عنوان"
                                 Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                 Margin="0,8"/>
                        
                        <ComboBox x:Name="WidgetTypeComboBox"
                                  md:HintAssist.Hint="نوع"
                                  Style="{StaticResource MaterialDesignFloatingHintComboBox}"
                                  Margin="0,8">
                            <ComboBoxItem Content="Chart" Tag="Chart"/>
                            <ComboBoxItem Content="Table" Tag="Table"/>
                            <ComboBoxItem Content="Card" Tag="Card"/>
                            <ComboBoxItem Content="KPI" Tag="KPI"/>
                            <ComboBoxItem Content="Gauge" Tag="Gauge"/>
                        </ComboBox>
                        
                        <ComboBox x:Name="WidgetSizeComboBox"
                                  md:HintAssist.Hint="اندازه"
                                  Style="{StaticResource MaterialDesignFloatingHintComboBox}"
                                  Margin="0,8">
                            <ComboBoxItem Content="کوچک" Tag="Small"/>
                            <ComboBoxItem Content="متوسط" Tag="Medium"/>
                            <ComboBoxItem Content="بزرگ" Tag="Large"/>
                            <ComboBoxItem Content="خیلی بزرگ" Tag="ExtraLarge"/>
                            <ComboBoxItem Content="تمام عرض" Tag="FullWidth"/>
                        </ComboBox>
                        
                        <TextBox x:Name="DataSourceTextBox"
                                 md:HintAssist.Hint="منبع داده"
                                 Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                 Margin="0,8"/>
                        
                        <TextBox x:Name="RefreshIntervalTextBox"
                                 md:HintAssist.Hint="بازه به‌روزرسانی (ثانیه)"
                                 Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                 Margin="0,8"/>
                        
                        <Separator Margin="0,16"/>
                        
                        <Expander Header="تنظیمات پیشرفته">
                            <StackPanel Margin="0,8">
                                <TextBox md:HintAssist.Hint="Query"
                                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                         AcceptsReturn="True"
                                         TextWrapping="Wrap"
                                         MinHeight="60"
                                         Margin="0,8"/>
                                
                                <TextBox md:HintAssist.Hint="Configuration (JSON)"
                                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                         AcceptsReturn="True"
                                         TextWrapping="Wrap"
                                         MinHeight="80"
                                         Margin="0,8"/>
                            </StackPanel>
                        </Expander>
                        
                        <Button Content="ذخیره تنظیمات"
                                Click="OnSaveSettings"
                                Style="{StaticResource MaterialDesignRaisedButton}"
                                HorizontalAlignment="Stretch"
                                Margin="0,16,0,0"/>
                    </StackPanel>
                </ScrollViewer>
            </GroupBox>
        </Grid>

        <!-- Dialog Buttons -->
        <StackPanel Grid.Row="1"
                    Orientation="Horizontal"
                    HorizontalAlignment="Center"
                    Margin="16">
            <Button Content="تأیید"
                    Click="OnOK"
                    IsDefault="True"
                    Style="{StaticResource MaterialDesignRaisedButton}"
                    Width="120"
                    Margin="0,0,8,0"/>
            
            <Button Content="انصراف"
                    Click="OnCancel"
                    IsCancel="True"
                    Style="{StaticResource MaterialDesignFlatButton}"
                    Width="120"/>
        </StackPanel>
    </Grid>
</Window>
<!-- پایان کد -->